<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pa1111</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
body {
    font-family: 'Arial', sans-serif;
    background-color: #f4f7fa;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
}
h1 {
    color: #2c3e50;
}
form {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    max-width: 400px;
    width: 100%;
}
form input {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1em;
}
button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    background-color: #27ae60;
    color: white;
    font-size: 1.1em;
    border: none;
    border-radius: 25px;
    cursor: pointer;
}
button:hover {
    background-color: #219d55;
}
#pix-info {
    display: none;
    background-color: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    text-align: center;
    max-width: 400px;
    margin-top: 20px;
}
#qrcode {
    margin: 10px auto;
}
#error {
    color: #e74c3c;
    font-size: 1em;
    margin-top: 10px;
    display: none;
}
</style>
</head>
<body>

<h1>Pagamento PIX</h1>
<form id="pix-form">
    <input type="text" id="name" placeholder="Nome completo" required>
    <input type="text" id="cpf" placeholder="CPF (000.000.000-00)" required>
    <input type="text" id="phone" placeholder="Telefone (00 90000-0000)" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="number" id="amount" placeholder="Valor em centavos (ex: 990)" required>
    <button type="submit">Gerar PIX</button>
</form>

<div id="pix-info">
    <h2>Escaneie o QR Code ou copie o código PIX</h2>
    <div id="qrcode"></div>
    <p>Código PIX: <strong id="pix-code"></strong></p>
    <button onclick="copiarPix()">Copiar Código PIX</button>
</div>

<p id="error"></p>

<script>
// Máscaras simples
function maskCPF(value) {
    return value.replace(/\D/g, '').replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
}
function maskPhone(value) {
    return value.replace(/\D/g, '').replace(/(\d{2})(\d{5})(\d{4})/, '$1 $2-$3');
}

document.getElementById('cpf').addEventListener('input', e => e.target.value = maskCPF(e.target.value));
document.getElementById('phone').addEventListener('input', e => e.target.value = maskPhone(e.target.value));

document.getElementById('pix-form').addEventListener('submit', async e => {
    e.preventDefault();
    await gerarPix();
});

async function gerarPix() {
    const name = document.getElementById('name').value;
    const cpf = document.getElementById('cpf').value.replace(/\D/g,'');
    const phone = document.getElementById('phone').value.replace(/\D/g,'');
    const email = document.getElementById('email').value;
    const amount = parseInt(document.getElementById('amount').value);

    try {
        const response = await fetch('/api/pix', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                amount,
                customer: { name, document: cpf, phone, email }
            })
        });

        if (!response.ok) {
            const err = await response.json();
            throw new Error(JSON.stringify(err));
        }

        const data = await response.json();
        const pixCode = data.pix.copy_and_paste;

        document.getElementById('pix-code').textContent = pixCode;
        document.getElementById("qrcode").innerHTML = "";
        new QRCode(document.getElementById("qrcode"), {
            text: pixCode,
            width: 200,
            height: 200,
            colorDark: "#2c3e50",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });

        document.getElementById('pix-info').style.display = 'block';
        document.getElementById('error').style.display = 'none';

    } catch (error) {
        console.error('Erro:', error);
        document.getElementById('error').textContent = 'Erro ao gerar PIX: ' + error.message;
        document.getElementById('error').style.display = 'block';
    }
}

function copiarPix() {
    const pixCode = document.getElementById('pix-code').textContent;
    if (pixCode) {
        navigator.clipboard.writeText(pixCode).then(() => alert('Código PIX copiado!'));
    }
}
</script>

</body>
</html>
